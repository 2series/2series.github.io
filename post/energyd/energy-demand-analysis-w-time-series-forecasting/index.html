<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.2.5">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Rihad Variawa">

  
  
  
    
  
  <meta name="description" content="Energy Demand Forecasting">

  
  <link rel="alternate" hreflang="en-us" href="../../../post/energyd/energy-demand-analysis-w-time-series-forecasting/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#3f51b5">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Playfair+Display:400,700|Fauna+One">
  

  <link rel="stylesheet" href="../../../styles.css">
  

  
  
    <script>
      window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
      ga('create', 'UA-132898309-1', 'auto');
      
      ga('require', 'eventTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'urlChangeTracker');
      ga('send', 'pageview');
    </script>
    <script async src="//www.google-analytics.com/analytics.js"></script>
    
    <script async src="https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js" integrity="sha512-HUmooslVKj4m6OBu0OgzjXXr+QuFYy/k7eLI5jdeEy/F4RSgMn6XRWRGkFi5IFaFgy7uFTkegp3Z0XnJf3Jq+g==" crossorigin="anonymous"></script>
    
  
  

  

  <link rel="manifest" href="../../../site.webmanifest">
  <link rel="icon" type="image/png" href="../../../img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="../../../img/icon-192.png">

  <link rel="canonical" href="../../../post/energyd/energy-demand-analysis-w-time-series-forecasting/">

  
  
  
  
    
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="twitter:site" content="@2series_rv">
  <meta property="twitter:creator" content="@2series_rv">
  
  <meta property="og:site_name" content="Rihad Variawa">
  <meta property="og:url" content="/post/energyd/energy-demand-analysis-w-time-series-forecasting/">
  <meta property="og:title" content="Energy Demand Analysis w/ Time Series Forecasting | Rihad Variawa">
  <meta property="og:description" content="Energy Demand Forecasting"><meta property="og:image" content="/img/headers/ere.jpg">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-02-02T00:00:00&#43;00:00">
  
  <meta property="article:modified_time" content="2019-02-02T00:00:00&#43;00:00">
  

  

  

  <title>Energy Demand Analysis w/ Time Series Forecasting | Rihad Variawa</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="../../../">Rihad Variawa</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav ml-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="../../../#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="../../../#projects">
            
            <span>Projects</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="../../../#posts">
            
            <span>Posts</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="../../../#publications">
            
            <span>Publications</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="../../../#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="../../../Rihad-Variawa-CV.pdf">
            
            <span>Resume</span>
            
          </a>
        </li>

        
        

      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        
        <li class="nav-item">
          <a class="nav-link js-dark-toggle" href="#"><i class="fas fa-moon" aria-hidden="true"></i></a>
        </li>
        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  









<div class="article-header">
  
  
  <img src="../../../img/headers/ere.jpg" class="article-banner" itemprop="image" alt="">
  

  
</div>




  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Energy Demand Analysis w/ Time Series Forecasting</h1>

  

  
    



<meta content="2019-02-02 00:00:00 &#43;0000 UTC" itemprop="datePublished">
<meta content="2019-02-02 00:00:00 &#43;0000 UTC" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Feb 2, 2019</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    8 min read
  </span>
  

  
  

  
  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder"></i>
    
    <a href="">Machine Learning</a>, 
    
    <a href="../../../categories/r/">R</a>
    
  </span>
  
  

  
    

  

</div>

    
















  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      


<div id="references" class="section level1">
<h1>References:</h1>
<ul>
<li>R. H. Shumway, D. S. Stoffer. <em>Time Series Analysis and Its Applications</em>. 2010.</li>
<li>R. J. Hyndman. <em>Forecasting: principles and practice</em>. 2013.</li>
<li>P. S. P. Cowpertwait, A. V. Metcalfe. <em>Introductory Time Series with R</em>. 2009.</li>
</ul>
<div id="preamble" class="section level2">
<h2>Preamble:</h2>
<p>This document focuses on an analysis of the energy demands of a European country.</p>
<p>The dataset of the daily energy needs (in GWh) between 2004 and 2010.</p>
</div>
<div id="reseach-questions" class="section level2">
<h2>Reseach questions:</h2>
<ol style="list-style-type: decimal">
<li>build a model for energy demand forecasting using time series analysis.</li>
</ol>
</div>
<div id="structure-of-analysis" class="section level2">
<h2>Structure of analysis:</h2>
<p>A time series forecast using the arima model as follows:</p>
<ol style="list-style-type: decimal">
<li>Exploratory data analysis</li>
<li>Data decomposition</li>
<li>seasonal ARIMA model</li>
<li>Forecast model</li>
</ol>
<pre class="r"><code>sourceURL &lt;- &#39;https://gist.githubusercontent.com/Peque/715e91350f0e68e3342f/raw/d28312ac0e49888a5079fcea188770acaf3aa4a2/mme.csv&#39;</code></pre>
<pre class="r"><code># download and load data into memory
tmp &lt;- tempfile()
download.file(sourceURL, tmp, method = &#39;curl&#39;)
df &lt;- read.csv(tmp)
unlink(tmp)</code></pre>
</div>
<div id="exploratory-data-analysis" class="section level2">
<h2>Exploratory data analysis</h2>
<pre class="r"><code>head(df)</code></pre>
<pre><code>      date demand
1 01-01-04 488.07
2 02-01-04 582.02
3 03-01-04 575.58
4 04-01-04 542.39
5 05-01-04 600.26
6 06-01-04 544.76</code></pre>
<pre class="r"><code># convert date strings to POSIX dates
df$date &lt;- strptime(df$date, format = &#39;%d-%m-%y&#39;)
# day of week
df$day &lt;- as.factor(strftime(df$date, format = &#39;%A&#39;))
# day of year
df$yearday &lt;- as.factor(strftime(df$date, format = &#39;%m%d&#39;))
# structure for analysis
str(df)</code></pre>
<pre><code>&#39;data.frame&#39;:   3288 obs. of  4 variables:
 $ date   : POSIXlt, format: &quot;2004-01-01&quot; &quot;2004-01-02&quot; ...
 $ demand : num  488 582 576 542 600 ...
 $ day    : Factor w/ 7 levels &quot;Friday&quot;,&quot;Monday&quot;,..: 5 1 3 4 2 6 7 5 1 3 ...
 $ yearday: Factor w/ 366 levels &quot;0101&quot;,&quot;0102&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...</code></pre>
<pre class="r"><code># df split to create test set
df_test &lt;- subset(df, date &gt;= strptime(&#39;01-01-2011&#39;, format = &#39;%d-%m-%Y&#39;))
df &lt;- subset(df, date &lt; strptime(&#39;01-01-2011&#39;, format = &#39;%d-%m-%Y&#39;))
ts &lt;- ts(df$demand, frequency = 1)</code></pre>
<pre class="r"><code># df and time series objects
demandts &lt;- xts(df$demand, df$date)
plot(demandts, main = &#39;Energy Demand Preview&#39;, xlab = &#39;Time&#39;, ylab = &#39;Demand (GWh)&#39;)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>Observations:</p>
<ul>
<li>A seasonal dependency of demand can be easily spotted in the graphics, although there are other factors that may affect the results, such as the temperature, holidays, weekends, etc..</li>
</ul>
<pre class="r"><code># demand by day of the week
ggplot(df, aes(day, demand)) +
  geom_boxplot(fill=&#39;slateblue&#39;, alpha=0.2) + xlab(&#39;Time&#39;) + ylab(&#39;Demand (GWh)&#39;) + ggtitle(&#39;Demand per day of the week&#39;) +
  theme_classic()</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Observations:</p>
<ul>
<li>During weekends, the demand decreases considerably compared to the rest of the week days.</li>
</ul>
<pre class="r"><code># aggregating demand by day of the year (average)
avg_demand_per_yearday &lt;- aggregate(demand ~ yearday, df, &#39;mean&#39;)

# computing the smooth curve for the time series. Data is replicated before computing the curve in order to achieve continuity
smooth_yearday &lt;- rbind(avg_demand_per_yearday, avg_demand_per_yearday, avg_demand_per_yearday, avg_demand_per_yearday, avg_demand_per_yearday)
smooth_yearday &lt;- lowess(smooth_yearday$demand, f = 1 / 45)
l &lt;- length(avg_demand_per_yearday$demand)
l0 &lt;- 2 * l + 1
l1 &lt;- 3 * l
smooth_yearday &lt;- smooth_yearday$y[l0:l1]

# plotting results
par(mfrow = c(1, 1))

# setting year to 2000 to allow existence of 29th February
dates &lt;- as.Date(paste(levels(df$yearday), &#39;2000&#39;), format = &#39;%m%d%Y&#39;)
plot(dates, avg_demand_per_yearday$demand, type = &#39;l&#39;, main = &#39;Average Daily Demand&#39;, xlab = &#39;Time&#39;, ylab = &#39;Demand (GWh)&#39;)
lines(dates, smooth_yearday, col = &#39;yellow&#39;, lwd = 2)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Observations:</p>
<ul>
<li>During the winter &amp; summer seasons the demand is clearly higher exept for, vacation periods. Holydays are also easily spotted in the graphics, being the lowest peaks of demand.</li>
</ul>
<pre class="r"><code>par(mfrow = c(1, 2))
diff &lt;- avg_demand_per_yearday$demand - smooth_yearday
abs_diff &lt;- abs(diff)
barplot(diff[order(-abs_diff)], main = &#39;Smoothing error&#39;, ylab = &#39;Error&#39;)
boxplot(diff, main = &#39;Smoothing error&#39;, ylab = &#39;Error&#39;)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Observations:</p>
<ul>
<li>The graphics show the errors. Notice how the biggest errors are all negative.</li>
</ul>
<pre class="r"><code>head(strftime(dates[order(-abs_diff)], format = &#39;%B %d&#39;), 10)</code></pre>
<pre><code> [1] &quot;January 01&quot;  &quot;December 25&quot; &quot;May 01&quot;      &quot;January 06&quot;  &quot;August 15&quot;  
 [6] &quot;December 08&quot; &quot;December 31&quot; &quot;October 12&quot;  &quot;November 01&quot; &quot;December 26&quot;</code></pre>
<p>The exact dates which are generating these errors are indeed, holidays or the day just before holidays (as is the case for the 25th November and 31th Devember).</p>
<pre class="r"><code>par(mfrow = c(2, 2))
acf(df$demand, 100, main = &#39;Autocorrelation&#39;)
acf(df$demand, 1500, main = &#39;Autocorrelation&#39;)
pacf(df$demand, 100, main = &#39;Partial autocorrelation&#39;)
pacf(df$demand, 1500, main = &#39;Partial autocorrelation&#39;)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Observations:</p>
<ul>
<li>The autocorrelation function shows a highly autocorrelated seasonal non-stationary process with, as expected, yearly and weekly cicles. The ACF alone, however, tells us little about the orders of dependence for ARMIA or AR processes. The PACF is better for AR models, and also shows the weekly and yearly seasons, although the correlation is lost faster with the lag.</li>
</ul>
</div>
<div id="data-decomposition" class="section level2">
<h2>Data decomposition</h2>
<p>I’ll decompose the time series for estimates of trend, seasonal, and random components using moving average method.</p>
<p>The model is:</p>
<p>Y[t]=T[t]∗S[t]∗e[t]</p>
<p>where</p>
<p>Y(t) is the number of weeks at time t,
T(t) is the trend component at time t,
S(t) is the seasonal component at time t,
e(t) is the random error component at time t.</p>
<pre class="r"><code># decomposition of weekly seasonal time series
wts &lt;- ts(ts, frequency = 7)
dec_wts &lt;- decompose(wts)
plot(dec_wts)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<pre class="r"><code># demand minus week seasonal
df$demand_mws &lt;- df$demand - as.numeric(dec_wts$season)</code></pre>
<pre class="r"><code># decomposition of yearly time series
yts &lt;- ts(subset(df, yearday != &#39;0229&#39;)$demand_mws, frequency = 365)
dec_yts &lt;- decompose(yts)
plot(dec_yts)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-14-1.png" width="672" />
Observations:</p>
<ul>
<li>Decomposition of the yearly seasonal time series. 29th February days are excluded for frequency matching. The time series is formed out of the original observation minus the weekly seasonal data.</li>
</ul>
<pre class="r"><code>days365 &lt;- which(df$yearday != &#39;0229&#39;)
february29ths &lt;- which(df$yearday == &#39;0229&#39;)
df$demand_mwys[days365] &lt;- df$demand_mws[days365] - as.numeric(dec_yts$season)
# Fill values on February 29th
df$demand_mwys[february29ths] &lt;- df$demand_mws[february29ths]</code></pre>
<pre class="r"><code># form new ts from original observations less the weekly and yearly seasonal data
par(mfrow = c(1, 1))
ts_mwys &lt;- ts(df$demand_mwys, frequency = 1)
demandts_mwys &lt;- xts(df$demand_mwys, df$date)
plot(demandts_mwys, main = &#39;Energy Demand Less Seasonal Data&#39;, xlab = &#39;Time&#39;, ylab = &#39;Demand (GWh)&#39;)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<pre class="r"><code># aggregating demand by day of the year (average)
avg_demand_mwys_per_yearday &lt;- aggregate(demand_mwys ~ yearday, df, &#39;mean&#39;)

# computing the smooth curve for the time series. Data is replicated before computing the curve in order to achieve continuity
smooth_yearday &lt;- rbind(avg_demand_mwys_per_yearday, avg_demand_mwys_per_yearday, avg_demand_mwys_per_yearday, avg_demand_mwys_per_yearday, avg_demand_mwys_per_yearday)
smooth_yearday &lt;- lowess(smooth_yearday$demand_mwys, f = 1 / 45)
l &lt;- length(avg_demand_mwys_per_yearday$demand_mwys)
l0 &lt;- 2 * l + 1
l1 &lt;- 3 * l
smooth_yearday &lt;- smooth_yearday$y[l0:l1]

# plotting the result
par(mfrow = c(1, 1))

# setting year to 2000 to allow existence of 29th February
dates &lt;- as.Date(paste(levels(df$yearday), &#39;2000&#39;), format = &#39;%m%d%Y&#39;)
plot(dates, avg_demand_mwys_per_yearday$demand_mwys, type = &#39;l&#39;, main = &#39;Mean Daily Demand&#39;, xlab = &#39;Time&#39;, ylab = &#39;Demand (GWh)&#39;)
lines(dates, smooth_yearday, col = &#39;yellow&#39;, lwd = 2)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<pre class="r"><code>par(mfrow = c(1, 2))
diff &lt;- avg_demand_mwys_per_yearday$demand_mwys - smooth_yearday
abs_diff &lt;- abs(diff)
barplot(diff[order(-abs_diff)], main = &#39;Smoothing error&#39;, ylab = &#39;Error&#39;)
boxplot(diff, main = &#39;Smoothing error&#39;, ylab = &#39;Error&#39;)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Observations:</p>
<ul>
<li>Plotting the average daily demand of the demand less the seasonal data shows a new error rate much lower than the one seen before.</li>
</ul>
<pre class="r"><code># new acf and pacf created
par(mfrow = c(1, 2))
acf(df$demand_mwys, 100, main = &#39;Autocorrelation&#39;)
pacf(df$demand_mwys, 100, main = &#39;Partial autocorrelation&#39;)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="seasonal-arima-model" class="section level2">
<h2>seasonal ARIMA model</h2>
<p>The initial ARIMA parameters have been found using the R <span class="math inline">\(auto.arima()\)</span> function. The differencing parameter <span class="math inline">\(d\)</span> is selected using the KPSS test. If the null hypothesis of stationarity is accepted when the KPSS is applied to the original time series, then <span class="math inline">\(d = 0\)</span>. Otherwise, the series is differenced until the KPSS accepts the null hypothesis. After that, <span class="math inline">\(p\)</span> and <span class="math inline">\(q\)</span> are selected using either AIC or BIC. The SARIMA model has been created using those ARIMA parameters.</p>
<pre class="r"><code>model &lt;- Arima(ts, order = c(2, 1, 2), list(order = c(1, 1, 1), period = 7))</code></pre>
<pre class="r"><code># forecast the error w/ test dataframe
auxts &lt;- ts
auxmodel &lt;- model
errs &lt;- c()
pred &lt;- c()
perc &lt;- c()
for (i in 1:nrow(df_test)) {
  p &lt;- as.numeric(predict(auxmodel, newdata = auxts, n.ahead = 1)$pred)
  pred &lt;- c(pred, p)
  errs &lt;- c(errs, p - df_test$demand[i])
  perc &lt;- c(perc, (p - df_test$demand[i]) / df_test$demand[i])
  auxts &lt;- ts(c(auxts, df_test$demand[i]), frequency = 7)
  auxmodel &lt;- Arima(auxts, model = auxmodel)
}
par(mfrow = c(1, 1))
plot(errs, type = &#39;l&#39;, main = &#39;Error in the forecast&#39;)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<pre class="r"><code>plot(pred, type = &#39;l&#39;, main = &#39;Real vs. Forecast&#39;, col = &#39;green&#39;)
lines(df_test$demand)
legend(&#39;topright&#39;, c(&#39;Real&#39;, &#39;Forecast&#39;), lty = 1, col = c(&#39;black&#39;, &#39;green&#39;))</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre class="r"><code>abserr &lt;- mean(abs(errs))
percerr &lt;- mean(abs(perc)) * 100
percerr</code></pre>
<pre><code>[1] 2.299037</code></pre>
<p>Mean error across test datadrame <strong>(2.3%)</strong>.</p>
<pre class="r"><code># special days present less demand than others. Those days may be taken into account in order to reduce the error
specialday &lt;- function(day) {
  correction = 0
  if (format(day, &#39;%m%d&#39;) %in% c(&#39;0101&#39;, &#39;0501&#39;, &#39;0106&#39;, &#39;0815&#39;, &#39;1012&#39;, &#39;1101&#39;, &#39;1206&#39;, &#39;1208&#39;, &#39;1224&#39;, &#39;1225&#39;, &#39;1226&#39;, &#39;1231&#39;))
      correction = -100
  else if (format(day, &#39;%m%d&#39;) %in% c(&#39;0319&#39;))
    correction = -50

# on Sunday, do not apply correction
  if (as.factor(strftime(day, format = &#39;%A&#39;)) == &#39;Sunday&#39;)
    return(0)
  return(correction)
}

model &lt;- Arima(ts, order = c(2, 1, 2), list(order = c(1, 1, 1), period = 7))
auxts &lt;- ts
auxmodel &lt;- model
errs &lt;- c()
pred &lt;- c()
perc &lt;- c()
for (i in 1:nrow(df_test)) {
  p &lt;- as.numeric(predict(auxmodel, newdata = auxts, n.ahead = 1)$pred)
  correction = specialday(df_test$date[i])
  pred &lt;- c(pred, p + correction)
  errs &lt;- c(errs, p + correction - df_test$demand[i])
  perc &lt;- c(perc, (p + correction - df_test$demand[i]) / df_test$demand[i])
  if (!correction)
    auxts &lt;- ts(c(auxts, df_test$demand[i]), frequency = 7)
  else
    auxts &lt;- ts(c(auxts, p), frequency = 7)
  auxmodel &lt;- Arima(auxts, model = auxmodel)
}
par(mfrow = c(1, 1))
plot(errs, type = &#39;l&#39;, main = &#39;Error in the forecast&#39;)</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<pre class="r"><code>plot(pred, type = &#39;l&#39;, main = &#39;Real vs. Forecast&#39;, col = &#39;green&#39;)
lines(df_test$demand)
legend(&#39;topright&#39;, c(&#39;Real&#39;, &#39;Forecast&#39;), lty = 1, col = c(&#39;black&#39;, &#39;green&#39;))</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<pre class="r"><code>abserr &lt;- mean(abs(errs))
percerr &lt;- mean(abs(perc)) * 100
percerr</code></pre>
<pre><code>[1] 1.956568</code></pre>
<p>Mean error across test dataframe <strong>(1,96%)</strong>.</p>
</div>
<div id="forecast-model" class="section level2">
<h2>Forecast Model</h2>
<pre class="r"><code>autoplot(forecast(Arima(tail(ts, 200), model = model))) +
  labs(x=&quot;Time&quot;, y=&quot;Energy Demand (GWh)&quot;) +
  theme_classic()</code></pre>
<p><img src="../../../post/energyD/2019-02-02-energy-demand-analysis-w-time-series-forecasting_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
</div>

    </div>

    





    
      






  







<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  

  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="../../../authors/admin">Rihad Variawa</a></h5>
    <h6 class="card-subtitle">Data Scientist</h6>
    <p class="card-text" itemprop="description">Super Inquisitive &amp; Challenge Seeker; looking at everything through a lens of numbers. A story-teller by nature and a problem-solver at the core.</p>
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="../../../#contact" >
          <i class="fas fa-envelope"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://twitter.com/2series_rv" target="_blank" rel="noopener">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://www.linkedin.com/in/rihad-variawa-7422017b" target="_blank" rel="noopener">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://github.com/2series" target="_blank" rel="noopener">
          <i class="fab fa-github"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>



      
      
    

    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  
  <p class="powered-by">
    <a href="../../../privacy/">Privacy Policy</a>
  </p>
  

  <p class="powered-by">
    &copy; 2020 &middot; 

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
      

      
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
      
    
    
    
    
    <script src="../../../js/academic.min.eeda67bb2d1f96265d85659d1edc7a5e.js"></script>

  </body>
</html>

